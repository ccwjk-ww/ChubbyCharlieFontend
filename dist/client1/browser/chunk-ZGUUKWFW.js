import{L as n,O as o,S as i,j as s,oc as a,qc as l}from"./chunk-45HGJHZR.js";var u=class r{constructor(e){this.http=e}apiUrl="https://www.chubbycharlieshop.com/api/auth";currentUserSubject=new s(this.getCurrentUser());currentUser$=this.currentUserSubject.asObservable();isLoggedInSubject=new s(this.hasToken());isLoggedIn$=this.isLoggedInSubject.asObservable();login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(n(t=>{t.success&&t.token&&(localStorage.setItem("token",t.token),localStorage.setItem("currentUser",JSON.stringify(t.employee)),this.currentUserSubject.next(t.employee),this.isLoggedInSubject.next(!0))}))}logout(){let e=this.getAuthHeaders();return this.http.post(`${this.apiUrl}/logout`,{},{headers:e}).pipe(n(()=>{localStorage.removeItem("token"),localStorage.removeItem("currentUser"),this.currentUserSubject.next(null),this.isLoggedInSubject.next(!1)}))}validateToken(){let e=this.getAuthHeaders();return this.http.get(`${this.apiUrl}/validate`,{headers:e})}changePassword(e,t){let g=this.getAuthHeaders();return this.http.post(`${this.apiUrl}/change-password`,{oldPassword:e,newPassword:t},{headers:g})}getToken(){return localStorage.getItem("token")}getCurrentUser(){let e=localStorage.getItem("currentUser");return e?JSON.parse(e):null}isLoggedIn(){return this.hasToken()}hasToken(){return!!localStorage.getItem("token")}isAdmin(){return this.getCurrentUser()?.role?.toUpperCase()==="ADMIN"}isManager(){return this.getCurrentUser()?.role?.toUpperCase()==="MANAGER"}isAuthorized(){return this.isAdmin()||this.isManager()}getAuthHeaders(){let e=this.getToken();return new a({Authorization:`Bearer ${e}`})}checkTokenExpiration(){this.validateToken().subscribe({next:e=>{e.valid||this.logout().subscribe()},error:()=>{this.logout().subscribe()}})}static \u0275fac=function(t){return new(t||r)(i(l))};static \u0275prov=o({token:r,factory:r.\u0275fac,providedIn:"root"})};export{u as a};
